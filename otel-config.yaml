receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  batch:
    timeout: 5s
    send_batch_size: 1000
  memory_limiter:
    check_interval: 1s
    limit_percentage: 75
    spike_limit_percentage: 25

connectors:
  # Generate metrics from spans (R.E.D: Request, Error, Duration)
  spanmetrics:
    histogram:
      explicit:
        buckets: [5ms, 10ms, 25ms, 50ms, 100ms, 250ms, 500ms, 1s, 2.5s, 5s, 10s]
    dimensions_cache_size: 1000
    aggregation_temporality: AGGREGATION_TEMPORALITY_CUMULATIVE
    metrics_flush_interval: 15s

exporters:
  # Export traces/logs to qryn via OTLP
  otlphttp/qryn:
    endpoint: http://${env:QRYN_HOST}:${env:QRYN_PORT}
    tls:
      insecure: true

  # Export metrics to qryn via Prometheus remote write
  prometheusremotewrite/qryn:
    endpoint: http://${env:QRYN_HOST}:${env:QRYN_PORT}/api/v1/prom/remote/write
    tls:
      insecure: true

  # Debug logging (optional, can be removed in production)
  debug:
    verbosity: basic

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [memory_limiter, batch]
      exporters: [otlphttp/qryn, spanmetrics, debug]
    metrics:
      receivers: [otlp, spanmetrics]
      processors: [memory_limiter, batch]
      exporters: [prometheusremotewrite/qryn, debug]
    logs:
      receivers: [otlp]
      processors: [memory_limiter, batch]
      exporters: [otlphttp/qryn, debug]
